---
title: "INPI FranceX"
author: "CPESR"
date: "`r Sys.Date()`"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
options(dplyr.summarise.inform = FALSE)
knitr::opts_chunk$set(fig.asp = 9/16, fig.retina = 2)

library(tidyverse)
library(ggcpesrthemes)
theme_set(theme_cpesr())
theme_cpesr_setup(authors = "Julien Gossa", source = "https://github.com/cpesr/RFC/")
```

## Données 

- https://www.inpi.fr/sites/default/files/Inpi_doc_tech_API_PI_v1.0_0.pdf

```{r load}
inpi <- read.csv2("inpi.csv", dec='.') %>%
  mutate(
    FranceX = as.factor(case_when(
      str_detect(str_to_upper(Mark),"(DE|EN|LA) FRANCE") ~ "[de|en|la] France",
      str_detect(str_to_upper(Mark),"FRAN.AIS") ~ "Français[e]",
      str_detect(str_to_upper(Mark),"FRANCE$") ~ "X France",
      str_detect(str_to_upper(Mark),"^FRANCE") ~ "France X",
      TRUE ~ "Autre"
    )))

write.csv2(inpi,"inpi_plus.csv")

colnames(inpi)
```

## Explorations

```{r, results='asis'}
inpi %>%
  summarise(Nombre = n(), .by=FranceX) %>%
  spoiler_table("FranceX",trim=Inf)
```

```{r, results='asis'}
inpi %>%
  summarise(Nombre = n(), .by=MarkCurrentStatusCode) %>%
  spoiler_table("MarkCurrentStatusCode",trim=Inf)
```

```{r}
inpi %>%
  mutate(Année_dépôt = as.numeric(str_sub(ApplicationDate,1,4))) %>%
  filter(Année_dépôt < 2024) %>%
  summarise(Nombre = n(), .by=c(FranceX,Année_dépôt)) %>%
  ggplot(aes(x=Année_dépôt,y=Nombre,color=FranceX)) + geom_smooth(se = FALSE) + geom_point()
```
